<div class="header">
  <span class="user-name" (click)="handleUsernameClick()">{{
    tokenService.tokenNameSurname()
    }}</span>
  <div class="search-bar">
    <div class="search-input">
      <input matInput #searchInput placeholder="Listeyi arayın" />
      <button mat-icon-button (click)="filterByName(searchInput.value)" >
        <mat-icon>search</mat-icon>
      </button>
    </div>
  </div>

  <div class="user-info">
    <button [matMenuTriggerFor]="filterMenu">
      <i class="material-icons">filter_list</i>{{ "filter" | transloco }}
      <span *ngIf="activeFilters.length != 0"> &nbsp;{{ activeFilters.length }} applied</span>
    </button>
    &nbsp;
    <button (click)="openDialog()" class="add-person-button">
      <i class="material-icons">person_add</i>{{ "addPeople" | transloco }}
    </button>
    <!-- <button>
      <i class="material-icons">share</i>{{ "share" | transloco }}
    </button> -->
    <button>
      <i class="material-icons">event</i>{{ "unplanned" | transloco }}
    </button>
    <!-- <button>
      <i class="material-icons">more_horiz</i>{{ "more" | transloco }}
    </button> -->
  </div>
</div>
<mat-menu #filterMenu="matMenu" [class]="customMenuClass">
  <div class="clear-button">
    <button (click)="clearFilter()">Clear</button>
  </div>
  <br>
  <button class="custom-menu-item" mat-menu-item [class.active]="activeFilters.includes('AssignedToMe')"
    (click)="applyFilter('AssignedToMe')">
    <mat-icon>account_circle</mat-icon> Assigned To Me
    <mat-icon *ngIf="activeFilters.includes('AssignedToMe')" class="selected-icon">check_circle
    </mat-icon>
  </button>


  <button class="custom-menu-item" mat-menu-item [class.active]="activeFilters.includes('DueDateThisWeek')"
    (click)="applyFilter('DueDateThisWeek')"> Due date this week <mat-icon>notification_important</mat-icon>
    <mat-icon *ngIf="activeFilters.includes('DueDateThisWeek')" class="selected-icon">check_circle</mat-icon>
  </button>

  <button class="custom-menu-item" mat-menu-item (click)="applyFilter('CompletedTasks')">
    <mat-icon>check_circle_outline</mat-icon>Completed Tasks
  </button>

  <span> <mat-icon>calendar_today</mat-icon> &nbsp; Date Range
    <button *ngIf="fromDate != null || toDate != null" (click)="cancelCreateDates()">(x)</button> <!--cancelDates() -->
  </span>

  <div class="date-input-container">
    <mat-form-field>
      <input matInput [matDatepicker]="fromDatePicker" placeholder="From Date"
        (dateChange)="applyFilter('BetweenDates')" [(ngModel)]="fromDate" />
      <mat-datepicker-toggle matSuffix [for]="fromDatePicker"></mat-datepicker-toggle>
      <mat-datepicker #fromDatePicker></mat-datepicker>
    </mat-form-field>
    <mat-icon class="custom-icon">arrow_forward</mat-icon>
    <mat-form-field>
      <input matInput [matDatepicker]="toDatePicker" placeholder="To Date" (dateChange)="applyFilter('BetweenDates')"
        [(ngModel)]="toDate" />
      <mat-datepicker-toggle matSuffix [for]="toDatePicker"></mat-datepicker-toggle>
      <mat-datepicker #toDatePicker></mat-datepicker>
    </mat-form-field>
  </div>

  <button class="custom-menu-item" mat-menu-item (click)="applyFilter('AssignedTo')">Assigned To Kişiler bekleniyor</button>
  <!-- Kişiler gelecek çoook kişi var ise üç nokta -->


  <span><mat-icon>view_column</mat-icon> Columns
    <span *ngIf="selectedColumns.length != 0">{{selectedColumns.length}}
      <button (click)="cancelPriorities()">(x)</button> <!--DÜZENLEME GEREKLİ  cancelColumns() -->
    </span>
  </span>


  <div *ngFor="let column of projectColumns">
    <label>
      <input type="checkbox" [value]="column.id" [checked]="selectedColumns.includes(column.id)"
        (change)="handleColumnSelect(column.id)" />
      {{ column.name }}
    </label>
  </div>
  <br>
  <span> <mat-icon>update</mat-icon>Update Date Range
    <button *ngIf="updatedFromDate != null || updatedToDate != null" (click)="cancelCreateDates()">(x)</button>
    <!--  CancelUpdateDates() -->
  </span>

  <div class="date-input-container">
    <mat-form-field>
      <input matInput [matDatepicker]="updatedFromDatePicker" placeholder="From Date"
        (dateChange)="applyFilter('UpdatedDate')" [(ngModel)]="updatedFromDate" />
      <mat-datepicker-toggle matSuffix [for]="updatedFromDatePicker"></mat-datepicker-toggle>
      <mat-datepicker #updatedFromDatePicker></mat-datepicker>
    </mat-form-field>
    <mat-icon class="custom-icon">arrow_forward</mat-icon>
    <mat-form-field>
      <input matInput [matDatepicker]="updatedToDatePicker" placeholder="To Date"
        (dateChange)="applyFilter('UpdatedDate')" [(ngModel)]="updatedToDate" />
      <mat-datepicker-toggle matSuffix [for]="updatedToDatePicker"></mat-datepicker-toggle>
      <mat-datepicker #updatedToDatePicker></mat-datepicker>
    </mat-form-field>
  </div>

  <span> <mat-icon>create</mat-icon>Creation Date Range
    <button *ngIf="createdFromDate != null || createdToDate != null" (click)="cancelCreateDates()">(x)</button>
  </span>

  <div class="date-input-container">
    <mat-form-field>
      <input matInput [matDatepicker]="createdFromDatePicker" placeholder="From Date"
        (dateChange)="applyFilter('CreatedDate')" [(ngModel)]="createdFromDate" />
      <mat-datepicker-toggle matSuffix [for]="createdFromDatePicker"></mat-datepicker-toggle>
      <mat-datepicker #createdFromDatePicker></mat-datepicker>
    </mat-form-field>
    <mat-icon class="custom-icon">arrow_forward</mat-icon>
    <mat-form-field>
      <input matInput [matDatepicker]="createdToDatePicker" placeholder="To Date"
        (dateChange)="applyFilter('CreatedDate')" [(ngModel)]="createdToDate" />
      <mat-datepicker-toggle matSuffix [for]="createdToDatePicker"></mat-datepicker-toggle>
      <mat-datepicker #createdToDatePicker></mat-datepicker>
    </mat-form-field>
  </div>


  <button class="custom-menu-item" mat-menu-item (click)="applyFilter('Reporter')">
    <mat-icon>remove_red_eye</mat-icon>Reporter  Kişiler bekleniyor
  </button>

  <span><mat-icon>priority_high</mat-icon> Priorities
    <span *ngIf="selectedPriorities.length != 0">{{selectedPriorities.length}}
      <button (click)="cancelPriorities()">(x)</button> <!--DÜZENLEME GEREKLİ  -->
    </span>
  </span>

  <div class="priority-images">
    <div class="img_div"> <img (click)="handlePriorityClick(1)" [class.selected]="selectedPriorities.includes(1)"
        src="../../assets/lowest.png" alt="Easy" />
    </div>
    <div class="img_div"> <img (click)="handlePriorityClick(2)" [class.selected]="selectedPriorities.includes(2)"
        src="../../assets/low.png" alt="Medium" />
    </div>
    <div class="img_div"> <img (click)="handlePriorityClick(3)" [class.selected]="selectedPriorities.includes(3)"
        src="../../assets/medium.png" alt="Normal" />
    </div>
    <div class="img_div"> <img (click)="handlePriorityClick(4)" [class.selected]="selectedPriorities.includes(4)"
        src="../../assets/high.png" alt="Difficult" />
    </div>
    <div class="img_div"> <img (click)="handlePriorityClick(5)" [class.selected]="selectedPriorities.includes(5)"
        src="../../assets/highest.png" alt="Difficult" />
    </div>

  </div>


</mat-menu>

<div class="outer-container">
  <div class="overflow-table-container">
    <table mat-table [dataSource]="filteredData">
      <!-- <ng-container matColumnDef="id">
                <th mat-header-cell *matHeaderCellDef>
                    <mat-icon>label</mat-icon> {{'id' | transloco}}
                </th>
                <td mat-cell *matCellDef="let ListTask ">{{ ListTask.id }}</td>
            </ng-container> -->

      <ng-container matColumnDef="name">
        <th mat-header-cell *matHeaderCellDef>
          <mat-icon>text_fields</mat-icon> Task {{ "name" | transloco }}
        </th>
        <td mat-cell *matCellDef="let ListTask">{{ ListTask.name }}</td>
      </ng-container>

      <ng-container matColumnDef="columnId">
        <th mat-header-cell *matHeaderCellDef>
          <mat-icon>view_column</mat-icon> {{ "column" | transloco }}
        </th>
        <td mat-cell *matCellDef="let ListTask">{{ ListTask.columnId }}</td>
      </ng-container>

      <ng-container matColumnDef="assigneeId">
        <th mat-header-cell *matHeaderCellDef>
          <mat-icon>person</mat-icon> {{ "assignee" | transloco }}
        </th>
        <td mat-cell *matCellDef="let ListTask">{{ ListTask.assigneeId | user:userList }}</td>
      </ng-container>

      <ng-container matColumnDef="reporterId">
        <th mat-header-cell *matHeaderCellDef>
          <mat-icon>report</mat-icon> {{ "reporter" | transloco }}
        </th>
        <td mat-cell *matCellDef="let ListTask">{{ ListTask.reporterId | user:userList }}</td>
      </ng-container>

      <ng-container matColumnDef="DueDate">
        <th mat-header-cell *matHeaderCellDef>
          <mat-icon>calendar_today</mat-icon> {{ "dueDate" | transloco }}
        </th>
        <td mat-cell *matCellDef="let ListTask">
          {{ ListTask.dueDate | date : "dd/MM/yy" }}
        </td>
      </ng-container>

      <!-- <ng-container matColumnDef="Priority">
                <th mat-header-cell *matHeaderCellDef>
                    <mat-icon>priority_high</mat-icon> {{'priority' | transloco}}
                </th>
                <td mat-cell *matCellDef="let ListTask">{{ priorityService.getIcon(ListTask.priority) }}</td>
            </ng-container> -->
      <ng-container matColumnDef="Priority">
        <th mat-header-cell *matHeaderCellDef>
          <mat-icon>priority_high</mat-icon> {{ "priority" | transloco }}
        </th>
        <td mat-cell *matCellDef="let ListTask">
          <img [src]="priorityService.getIcon(ListTask.priority)" alt="Priority Icon" class="priority-icon" />
        </td>
      </ng-container>

      <ng-container matColumnDef="UpdateDate">
        <th mat-header-cell *matHeaderCellDef>
          <mat-icon>update</mat-icon> {{ "updateDate" | transloco }}
        </th>
        <td mat-cell *matCellDef="let ListTask">
          {{ ListTask.updatedDate | date : "dd/MM/yy" }}
        </td>
      </ng-container>

      <ng-container matColumnDef="CreateDate">
        <th mat-header-cell *matHeaderCellDef>
          <mat-icon>create</mat-icon> {{ "createdDate" | transloco }}
        </th>
        <td mat-cell *matCellDef="let ListTask">
          {{ ListTask.createdDate | date : "dd/MM/yy" }}
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="[
          'name',
          'columnId',
          'assigneeId',
          'reporterId',
          'DueDate',
          'Priority',
          'UpdateDate',
          'CreateDate'
        ]"></tr>
      <tr mat-row *matRowDef="
          let row;
          columns: [
            'name',
            'columnId',
            'assigneeId',
            'reporterId',
            'DueDate',
            'Priority',
            'UpdateDate',
            'CreateDate'
          ]
        "></tr>
    </table>
  </div>
</div>

<div class="add-button-container">
  <button mat-raised-button color="primary" (click)="openDialog()">
    Oluştur
  </button>
</div>